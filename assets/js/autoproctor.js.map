{"version":3,"file":"autoproctor.js","mappings":"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","sources":["webpack:///./autoproctor.js"],"sourcesContent":["(function () {\n  //   if (!window.AutoProctor || !window.JRJ_AP) return;\n  if (!JRJ_AP.enabled) return;\n\n  const CLIENT_ID = JRJ_AP.clientId;\n  const CLIENT_SECRET = JRJ_AP.secret || null;\n\n  // --- helpers: generate ID & HMAC(Base64) ---\n  const getTestAttemptId = () =>\n    (JRJ_AP.testAttemptId &&\n      String(JRJ_AP.testAttemptId).trim() +\n        Math.random().toString(36).slice(2, 7)) ||\n    Math.random().toString(36).slice(2, 10);\n\n  function hmacBase64(msg, secret) {\n    const secretWordArray = CryptoJS.enc.Utf8.parse(secret);\n    const messageWordArray = CryptoJS.enc.Utf8.parse(msg);\n    const hash = CryptoJS.HmacSHA256(messageWordArray, secretWordArray);\n    return CryptoJS.enc.Base64.stringify(hash);\n  }\n\n  const testAttemptId = getTestAttemptId();\n  const hashedTestAttemptId = CLIENT_SECRET\n    ? hmacBase64(testAttemptId, CLIENT_SECRET)\n    : null;\n\n  const credentials = {\n    clientId: CLIENT_ID,\n    testAttemptId,\n    hashedTestAttemptId,\n  };\n\n  const opts = JRJ_AP.opts || {};\n\n  const getReportOptions = () => {\n    return {\n      groupReportsIntoTabs: true,\n      userDetails: {\n        name: JRJ_AP.userName || \"\",\n        email: JRJ_AP.email || \"\",\n      },\n    };\n  };\n\n  console.log(opts);\n\n  let apInstance = null;\n  let started = false;\n  let stopped = false;\n\n  async function startProctoring() {\n    if (started) return;\n    started = true;\n\n    console.log(\"[JRJ AP] Initializing AutoProctorâ€¦\");\n    try {\n      apInstance = new AutoProctor(credentials);\n      window.__ap = apInstance; // for debugging\n      await apInstance.setup(opts);\n\n      await apInstance.start(); // start monitoring\n      console.log(\"[JRJ AP] Monitoring started.\");\n      window.addEventListener(\"apMonitoringStarted\", () => {\n        document.getElementById(\"ap-test-proctoring-status\").innerHTML =\n          \"Proctoring...\";\n      });\n    } catch (err) {\n      console.error(\"[JRJ AP] Failed to initialize AutoProctor\", err);\n    }\n  }\n\n  async function stopProctoring() {\n    if (stopped) return;\n    stopped = true;\n    try {\n      await apInstance.stop();\n\n      window.addEventListener(\"apMonitoringStopped\", async () => {\n        const reportOptions = getReportOptions();\n        apInstance.showReport(reportOptions);\n\n        document.getElementById(\"ap-test-proctoring-status\").innerHTML =\n          \"Proctoring stopped\";\n      });\n    } catch (e) {\n      console.warn(\"[JRJ AP] stop error\", e);\n    } finally {\n      safeFetchLog({ event: \"stopped\" });\n    }\n  }\n\n    // -- safe fetch log ---\n  function safeFetchLog(payload = {}, event = \"started\") {\n    const body = {\n      quiz_id: JRJ_AP.quizId || 0,\n      attempt_id: testAttemptId, // MUST be defined\n      event,\n      payload,\n      user: {\n        name: JRJ_AP.userName,\n        email: JRJ_AP.email,\n      },\n    };\n\n    fetch(JRJ_AP.root + \"autoproctor/attempts\", {\n      method: \"POST\",\n      credentials: \"same-origin\",\n      headers: {\n        \"X-WP-Nonce\": JRJ_AP.nonce,\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(body),\n      keepalive: true,\n    }).then((r) =>\n      r.text().then((t) => console.log(\"ap attempt ->\", r.status, t))\n    );\n  }\n\n  // --- Start triggers (LD start/continue buttons) ---\n  document.addEventListener(\n    \"click\",\n    (e) => {\n      const btn = e.target.closest(\n        '.wpProQuiz_button[name=\"startQuiz\"], .wpProQuiz_button[name=\"restartQuiz\"], .ld-quiz-start, .quiz_continue_link'\n      );\n      if (!btn) return;\n      startProctoring();\n    },\n    { capture: true }\n  );\n\n  // --- Stop trigger #1: click on Finish/Submit buttons ---\n  document.addEventListener(\n    \"click\",\n    (e) => {\n      const finishBtn = e.target.closest(\n        '#quiz_continue_link, .wpProQuiz_button[value=\"Finish Quiz\"], .wpProQuiz_button[name=\"endQuizSummary\"], .ld-quiz-submit, .ld-quiz-finish'\n      );\n      if (!finishBtn) return;\n      console.log(\"stop test\");\n\n      stopProctoring();\n      // small delay to let LD process submit\n      // setTimeout(() => stopProctoring(), 1500);\n    },\n    { capture: true }\n  );\n\n  // Auto start if configured\n  window.addEventListener(\"load\", () => {\n    if (JRJ_AP.autoStart) startProctoring();\n  });\n\n  // Violation relay (optional)\n  window.addEventListener(\"apViolation\", (e) => {\n    safeFetchLog({ event: \"violation\", detail: e.detail || {} });\n  });\n})();\n"],"names":["JRJ_AP","enabled","CLIENT_ID","clientId","CLIENT_SECRET","secret","getTestAttemptId","testAttemptId","String","trim","Math","random","toString","slice","hmacBase64","msg","secretWordArray","CryptoJS","enc","Utf8","parse","messageWordArray","hash","HmacSHA256","Base64","stringify","hashedTestAttemptId","credentials","opts","getReportOptions","groupReportsIntoTabs","userDetails","name","userName","email","console","log","apInstance","started","stopped","startProctoring","AutoProctor","window","__ap","setup","start","addEventListener","document","getElementById","innerHTML","err","error","stopProctoring","stop","reportOptions","showReport","e","warn","safeFetchLog","event","payload","body","quiz_id","quizId","attempt_id","user","fetch","root","method","headers","nonce","JSON","keepalive","then","r","text","t","status","btn","target","closest","capture","finishBtn","autoStart","detail"],"sourceRoot":""}